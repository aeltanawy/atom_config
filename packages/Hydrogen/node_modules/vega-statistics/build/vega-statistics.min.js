!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],n):n((t=t||self).vega={},t.d3)}(this,(function(t,n){"use strict";function*e(t,n){if(void 0===n)for(let n of t)null!=n&&(n=+n)>=n&&(yield n);else{let e=-1;for(let r of t)null!=(r=n(r,++e,t))&&(r=+r)>=r&&(yield r)}}function r(t,r,o){var u=Float64Array.from(e(t,o));return u.sort(n.ascending),r.map(t=>n.quantileSorted(u,t))}function o(t,n){return r(t,[.25,.5,.75],n)}t.random=Math.random;const u=Math.sqrt(2*Math.PI),a=Math.SQRT2;let l=NaN;function f(n,e){n=n||0,e=null==e?1:e;let r,o,u=0,a=0;if(l==l)u=l,l=NaN;else{do{r=(u=2*t.random()-1)*u+(a=2*t.random()-1)*a}while(0===r||r>1);u*=o=Math.sqrt(-2*Math.log(r)/r),l=a*o}return n+u*e}function i(t,n,e){const r=(t-(n||0))/(e=null==e?1:e);return Math.exp(-.5*r*r)/(e*u)}function c(t,n,e){let r,o=(t-(n=n||0))/(e=null==e?1:e),u=Math.abs(o);if(u>37)r=0;else{let t,n=Math.exp(-u*u/2);u<7.07106781186547?(r=n*(t=(t=(t=(t=(t=(t=.0352624965998911*u+.700383064443688)*u+6.37396220353165)*u+33.912866078383)*u+112.079291497871)*u+221.213596169931)*u+220.206867912376),r/=t=(t=(t=(t=(t=(t=(t=.0883883476483184*u+1.75566716318264)*u+16.064177579207)*u+86.7807322029461)*u+296.564248779674)*u+637.333633378831)*u+793.826512519948)*u+440.413735824752):r=n/(t=u+1/(t=u+2/(t=u+3/(t=u+4/(t=u+.65)))))/2.506628274631}return o>0?1-r:r}function s(t,n,e){return t<0||t>1?NaN:(n||0)+(null==e?1:e)*a*function(t){let n,e=-Math.log((1-t)*(1+t));e<6.25?n=1.6536545626831027+(n=.24015818242558962+(n=(n=(n=.00018673420803405714+(n=(n=(n=4.2347877827932404e-7+(n=(n=(n=1.0512122733215323e-9+(n=(n=(n=26335093153082323e-28+(n=(n=(n=6637638134358324e-30+(n=20972767875968562e-33+(n=(n=11157877678025181e-33+(n=128584807152564e-32+(n=(n=-364441206401782e-35)*(e-=3.125)-16850591381820166e-35)*e)*e)*e-1333171662854621e-31)*e)*e)*e-4054566272975207e-29)*e-8151934197605472e-29)*e)*e-12975133253453532e-27)*e-5415412054294628e-26)*e)*e-4.112633980346984e-9)*e-2.9070369957882005e-8)*e)*e-13654692000834679e-22)*e-13882523362786469e-21)*e)*e-.000740702534166267)*e-.006033670871430149)*e)*e:e<16?(e=Math.sqrt(e)-3.25,n=3.0838856104922208+(n=1.0052589676941592+(n=.005370914553590064+(n=(n=.002491442096107851+(n=(n=.0009532893797373805+(n=(n=24031110387097894e-21+(n=6828485145957318e-20+(n=(n=12475304481671779e-21+(n=29234449089955446e-22+(n=(n=15027403968909828e-22+(n=1.8239629214389228e-8+(n=(n=9.075656193888539e-8+(n=2.2137376921775787e-9)*e)*e-2.7517406297064545e-7)*e)*e)*e-4013867526981546e-21)*e)*e)*e-47318229009055734e-21)*e)*e)*e-.0003550375203628475)*e)*e-.0016882755560235047)*e)*e-.003751208507569241)*e)*e)*e):Number.isFinite(e)?(e=Math.sqrt(e)-5,n=4.849906401408584+(n=1.0103004648645344+(n=(n=(n=7599527703001776e-20+(n=(n=4526062597223154e-21+(n=(n=2.2900482228026655e-7+(n=(n=2.914795345090108e-8+(n=(n=7.61570120807834e-9+(n=(n=1.5076572693500548e-9+(n=(n=-27109920616438573e-27)*e-2.555641816996525e-10)*e)*e-3.789465440126737e-9)*e)*e-1.496002662714924e-8)*e)*e-6.771199775845234e-8)*e)*e-9.9298272942317e-7)*e)*e-1968177810553167e-20)*e)*e-.00021503011930044477)*e-.00013871931833623122)*e)*e):n=1/0;return n*t}(2*t-1)}function h(t,n){var e,r,o={mean:function(t){return arguments.length?(e=t||0,o):e},stdev:function(t){return arguments.length?(r=null==t?1:t,o):r},sample:()=>f(e,r),pdf:t=>i(t,e,r),cdf:t=>c(t,e,r),icdf:t=>s(t,e,r)};return o.mean(t).stdev(n)}function d(t){var e=t.length,r=o(t),u=(r[2]-r[0])/1.34,a=u?Math.min(n.deviation(t),u):a||Math.abs(t[0])||1;return 1.06*a*Math.pow(e,-.2)}function p(t,n){return t=t||0,n=null==n?1:n,Math.exp(t+f()*n)}function m(t,n,e){if(t<=0)return 0;n=n||0,e=null==e?1:e;const r=(Math.log(t)-n)/e;return Math.exp(-.5*r*r)/(e*u*t)}function M(t,n,e){return c(Math.log(t),n,e)}function g(t,n,e){return Math.exp(s(t,n,e))}function v(n,e){return null==e&&(e=null==n?1:n,n=0),n+(e-n)*t.random()}function b(t,n,e){return null==e&&(e=null==n?1:n,n=0),t>=n&&t<=e?1/(e-n):0}function x(t,n,e){return null==e&&(e=null==n?1:n,n=0),t<n?0:t>e?1:(t-n)/(e-n)}function w(t,n,e){return null==e&&(e=null==n?1:n,n=0),t>=0&&t<=1?n+t*(e-n):NaN}function y(t,n,e,r){const o=r-t*t,u=Math.abs(o)<1e-24?0:(e-t*n)/o;return[n-u*t,u]}function N(t,n,e,r){t=t.filter(t=>{let r=n(t),o=e(t);return null!=r&&(r=+r)>=r&&null!=o&&(o=+o)>=o}),r&&t.sort((t,e)=>n(t)-n(e));const o=new Float64Array(t.length),u=new Float64Array(t.length);let a=0;for(let r of t)o[a]=n(r),u[a]=e(r),++a;return[o,u]}function q(t,n,e,r){let o,u,a=-1,l=-1;for(let f of t)o=n(f,++a,t),u=e(f,a,t),null!=o&&(o=+o)>=o&&null!=u&&(u=+u)>=u&&r(o,u,++l)}function A(t,n,e,r,o){let u=0,a=0;return q(t,n,e,(t,n)=>{const e=n-o(t),l=n-r;u+=e*e,a+=l*l}),1-u/a}function F(t,n,e){let r=0,o=0,u=0,a=0,l=0;q(t,n,e,(t,n)=>{r+=t,o+=n,u+=t*n,a+=t*t,++l});const f=y(r/l,o/l,u/l,a/l),i=t=>f[0]+f[1]*t;return{coef:f,predict:i,rSquared:A(t,n,e,o/l,i)}}function L(t,n,e){let r=0,o=0,u=0,a=0,l=0,f=0,i=0,c=0;q(t,n,e,(t,n)=>{const e=t*t;r+=t,o+=n,u+=e,a+=e*t,l+=e*e,f+=t*n,i+=e*n,++c});const s=u-r*r/c,h=a-u*r/c,d=l-u*u/c,p=s*d-h*h,m=((i-=u*(o/=c))*s-(f-=r*o)*h)/p,M=(f*d-i*h)/p,g=o-M*(r/c)-m*(u/c),v=t=>m*t*t+M*t+g;return{coef:[g,M,m],predict:v,rSquared:A(t,n,e,o,v)}}const S=2,E=1e-12;function P(t){return(t=1-t*t*t)*t*t}function U(t,n,e){let r=t[n],o=e[0],u=e[1]+1;if(!(u>=t.length))for(;n>o&&t[u]-r<=r-t[o];)e[0]=++o,e[1]=u,++u}const I=.1*Math.PI/180;function k(t,n,e){const r=Math.atan2(e[1]-t[1],e[0]-t[0]),o=Math.atan2(n[1]-t[1],n[0]-t[0]);return Math.abs(r-o)}t.bin=function(t){var n,e,r,o,u,a,l,f,i=t.maxbins||20,c=t.base||10,s=Math.log(c),h=t.divide||[5,2],d=t.extent[0],p=t.extent[1],m=t.span||p-d||Math.abs(d)||1;if(t.step)n=t.step;else if(t.steps){for(u=m/i,a=0,l=t.steps.length;a<l&&t.steps[a]<u;++a);n=t.steps[Math.max(0,a-1)]}else{for(e=Math.ceil(Math.log(i)/s),r=t.minstep||0,n=Math.max(r,Math.pow(c,Math.round(Math.log(m)/s)-e));Math.ceil(m/n)>i;)n*=c;for(a=0,l=h.length;a<l;++a)(u=n/h[a])>=r&&m/u<=i&&(n=u)}return o=(u=Math.log(n))>=0?0:1+~~(-u/s),f=Math.pow(c,-o-1),(t.nice||void 0===t.nice)&&(d=d<(u=Math.floor(d/n+f)*n)?u-n:u,p=Math.ceil(p/n)*n),{start:d,stop:p===d?d+n:p,step:n}},t.bootstrapCI=function(r,o,u,a){if(!r.length)return[void 0,void 0];var l,f,i,c,s=Float64Array.from(e(r,a)),h=s.length,d=o;for(i=0,c=Array(d);i<d;++i){for(l=0,f=0;f<h;++f)l+=s[~~(t.random()*h)];c[i]=l/h}return c.sort(n.ascending),[n.quantile(c,u/2),n.quantile(c,1-u/2)]},t.cumulativeLogNormal=M,t.cumulativeNormal=c,t.cumulativeUniform=x,t.densityLogNormal=m,t.densityNormal=i,t.densityUniform=b,t.dotbin=function(t,n,e,r){r=r||(t=>t);let o,u=0,a=1,l=t.length,f=new Float64Array(l),i=r(t[0]),c=i,s=i+n;for(;a<l;++a){if((o=r(t[a]))>=s){for(c=(i+c)/2;u<a;++u)f[u]=c;s=o+n,i=o}c=o}for(c=(i+c)/2;u<a;++u)f[u]=c;return e?function(t,n){let e,r,o=t.length,u=0,a=1;for(;t[u]===t[a];)++a;for(;a<o;){for(e=a+1;t[a]===t[e];)++e;if(t[a]-t[a-1]<n){for(r=a+(u+e-a-a>>1);r<a;)t[r++]=t[a];for(;r>a;)t[r--]=t[u]}u=a,a=e}return t}(f,n+n/4):f},t.quantileLogNormal=g,t.quantileNormal=s,t.quantileUniform=w,t.quantiles=r,t.quartiles=o,t.randomInteger=function(n,e){null==e&&(e=n,n=0);var r,o,u,a={};return a.min=function(t){return arguments.length?(u=o-(r=t||0),a):r},a.max=function(t){return arguments.length?(u=(o=t||0)-r,a):o},a.sample=function(){return r+Math.floor(u*t.random())},a.pdf=function(t){return t===Math.floor(t)&&t>=r&&t<o?1/u:0},a.cdf=function(t){var n=Math.floor(t);return n<r?0:n>=o?1:(n-r+1)/u},a.icdf=function(t){return t>=0&&t<=1?r-1+Math.floor(t*u):NaN},a.min(n).max(e)},t.randomKDE=function(n,e){var r=h(),o={},u=0;return o.data=function(t){return arguments.length?(n=t,u=t?t.length:0,o.bandwidth(e)):n},o.bandwidth=function(t){return arguments.length?(!(e=t)&&n&&(e=d(n)),o):e},o.sample=function(){return n[~~(t.random()*u)]+e*r.sample()},o.pdf=function(t){for(var o=0,a=0;a<u;++a)o+=r.pdf((t-n[a])/e);return o/e/u},o.cdf=function(t){for(var o=0,a=0;a<u;++a)o+=r.cdf((t-n[a])/e);return o/u},o.icdf=function(){throw Error("KDE icdf not supported.")},o.data(n)},t.randomLCG=function(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}},t.randomLogNormal=function(t,n){var e,r,o={mean:function(t){return arguments.length?(e=t||0,o):e},stdev:function(t){return arguments.length?(r=null==t?1:t,o):r},sample:()=>p(e,r),pdf:t=>m(t,e,r),cdf:t=>M(t,e,r),icdf:t=>g(t,e,r)};return o.mean(t).stdev(n)},t.randomMixture=function(n,e){var r,o={},u=0;function a(t){var n,e=[],r=0;for(n=0;n<u;++n)r+=e[n]=null==t[n]?1:+t[n];for(n=0;n<u;++n)e[n]/=r;return e}return o.weights=function(t){return arguments.length?(r=a(e=t||[]),o):e},o.distributions=function(t){return arguments.length?(t?(u=t.length,n=t):(u=0,n=[]),o.weights(e)):n},o.sample=function(){for(var e=t.random(),o=n[u-1],a=r[0],l=0;l<u-1;a+=r[++l])if(e<a){o=n[l];break}return o.sample()},o.pdf=function(t){for(var e=0,o=0;o<u;++o)e+=r[o]*n[o].pdf(t);return e},o.cdf=function(t){for(var e=0,o=0;o<u;++o)e+=r[o]*n[o].cdf(t);return e},o.icdf=function(){throw Error("Mixture icdf not supported.")},o.distributions(n).weights(e)},t.randomNormal=h,t.randomUniform=function(t,n){var e,r,o={min:function(t){return arguments.length?(e=t||0,o):e},max:function(t){return arguments.length?(r=null==t?1:t,o):r},sample:()=>v(e,r),pdf:t=>b(t,e,r),cdf:t=>x(t,e,r),icdf:t=>w(t,e,r)};return null==n&&(n=null==t?1:t,t=0),o.min(t).max(n)},t.regressionExp=function(t,n,e){let r=0,o=0,u=0,a=0,l=0,f=0;q(t,n,e,(t,n)=>{const e=Math.log(n),i=t*n;r+=n,u+=i,l+=t*i,o+=n*e,a+=i*e,++f});const i=y(u/r,o/r,a/r,l/r),c=t=>i[0]*Math.exp(i[1]*t);return i[0]=Math.exp(i[0]),{coef:i,predict:c,rSquared:A(t,n,e,r/f,c)}},t.regressionLinear=F,t.regressionLoess=function(t,e,r,o){const[u,a]=N(t,e,r,!0),l=u.length,f=Math.max(2,~~(o*l)),i=new Float64Array(l),c=new Float64Array(l),s=new Float64Array(l).fill(1);for(let t=-1;++t<=S;){const e=[0,f-1];for(let t=0;t<l;++t){const n=u[t],r=e[0],o=e[1],l=n-u[r]>u[o]-n?r:o;let f=0,h=0,d=0,p=0,m=0,M=1/Math.abs(u[l]-n||1);for(let t=r;t<=o;++t){const e=u[t],r=a[t],o=P(Math.abs(n-e)*M)*s[t],l=e*o;f+=o,h+=l,d+=r*o,p+=r*l,m+=e*l}const[g,v]=y(h/f,d/f,p/f,m/f);i[t]=g+v*n,c[t]=Math.abs(a[t]-i[t]),U(u,t+1,e)}if(t===S)break;const r=n.median(c);if(Math.abs(r)<E)break;for(let t,n,e=0;e<l;++e)t=c[e]/(6*r),s[e]=t>=1?E:(n=1-t*t)*n}return function(t,n){const e=t.length,r=[];for(let o,u=0,a=0,l=[];u<e;++u)o=t[u],l[0]===o?l[1]+=(n[u]-l[1])/++a:(a=0,l=[o,n[u]],r.push(l));return r}(u,i)},t.regressionLog=function(t,n,e){let r=0,o=0,u=0,a=0,l=0;q(t,n,e,(t,n)=>{t=Math.log(t),r+=t,o+=n,u+=t*n,a+=t*t,++l});const f=y(r/l,o/l,u/l,a/l),i=t=>f[0]+f[1]*Math.log(t);return{coef:f,predict:i,rSquared:A(t,n,e,o/l,i)}},t.regressionPoly=function(t,n,e,r){if(1===r)return F(t,n,e);if(2===r)return L(t,n,e);const[o,u]=N(t,n,e),a=o.length,l=[],f=[],i=r+1;let c,s,h,d,p,m=0;for(c=0;c<a;++c)m+=u[c];for(c=0;c<i;++c){for(h=0,d=0;h<a;++h)d+=Math.pow(o[h],c)*u[h];for(l.push(d),p=new Float64Array(i),s=0;s<i;++s){for(h=0,d=0;h<a;++h)d+=Math.pow(o[h],c+s);p[s]=d}f.push(p)}f.push(l);const M=function(t){const n=t.length-1,e=[];let r,o,u,a,l;for(r=0;r<n;++r){for(a=r,o=r+1;o<n;++o)Math.abs(t[r][o])>Math.abs(t[r][a])&&(a=o);for(u=r;u<n+1;++u)l=t[u][r],t[u][r]=t[u][a],t[u][a]=l;for(o=r+1;o<n;++o)for(u=n;u>=r;u--)t[u][o]-=t[u][r]*t[r][o]/t[r][r]}for(o=n-1;o>=0;--o){for(l=0,u=o+1;u<n;++u)l+=t[u][o]*e[u];e[o]=(t[n][o]-l)/t[o][o]}return e}(f),g=t=>{let n=0,e=0,r=M.length;for(;e<r;++e)n+=M[e]*Math.pow(t,e);return n};return{coef:M,predict:g,rSquared:A(t,n,e,m/a,g)}},t.regressionPow=function(t,n,e){let r=0,o=0,u=0,a=0,l=0,f=0;q(t,n,e,(t,n)=>{const e=Math.log(t),i=Math.log(n);r+=e,o+=i,u+=e*i,a+=e*e,l+=n,++f});const i=y(r/f,o/f,u/f,a/f),c=t=>i[0]*Math.pow(t,i[1]);return i[0]=Math.exp(i[0]),{coef:i,predict:c,rSquared:A(t,n,e,l/f,c)}},t.regressionQuad=L,t.sampleCurve=function(t,n,e,r){e=e||25,r=Math.max(e,r||200);const o=n=>[n,t(n)],u=n[0],a=n[1],l=a-u,f=l/r,i=[o(u)],c=[];if(e===r){for(let t=1;t<r;++t)i.push(o(u+t/e*l));return i.push(o(a)),i}c.push(o(a));for(let t=e;--t>0;)c.push(o(u+t/e*l));let s=i[0],h=c[c.length-1];for(;h;){const t=o((s[0]+h[0])/2);t[0]-s[0]>=f&&k(s,t,h)>I?c.push(t):(s=h,i.push(h),c.pop()),h=c[c.length-1]}return i},t.sampleLogNormal=p,t.sampleNormal=f,t.sampleUniform=v,t.setRandom=function(n){t.random=n},Object.defineProperty(t,"__esModule",{value:!0})}));