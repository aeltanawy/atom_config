!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vega-expression"),require("vega-dataflow"),require("vega-selections"),require("vega-statistics"),require("vega-util"),require("d3-array"),require("d3-color"),require("d3-format"),require("d3-time-format"),require("vega-scale"),require("d3-geo"),require("vega-scenegraph")):"function"==typeof define&&define.amd?define(["exports","vega-expression","vega-dataflow","vega-selections","vega-statistics","vega-util","d3-array","d3-color","d3-format","d3-time-format","vega-scale","d3-geo","vega-scenegraph"],e):e((t=t||self).vega={},t.vega,t.vega,t.vega,t.vega,t.vega,t.d3,t.d3,t.d3,t.d3,t.vega,t.d3,t.vega)}(this,(function(t,e,n,r,o,i,a,c,u,s,l,f,d){"use strict";function g(t){const e=this.context.data[t];return e?e.values.value:[]}function m(t,e,n){const r=this.context.data[t]["index:"+e],o=r?r.value.get(n):void 0;return o?o.count:o}function p(t,e){const n=this.context.dataflow,r=this.context.data[t].input;return n.pulse(r,n.changeset().remove(i.truthy).insert(e)),1}function h(t,e,n){if(t){const n=this.context.dataflow,r=t.mark.source;n.pulse(r,n.changeset().encode(t,e))}return void 0!==n?n:t}const v={};function y(t,e,n){let r=t+":"+n,o=v[r];return o&&o[0]===e||(v[r]=o=[e,e(n)]),o[1]}function b(t,e){return y("format",u.format,e)(t)}function x(t,e){return y("timeFormat",s.timeFormat,e)(t)}function w(t,e){return y("utcFormat",s.utcFormat,e)(t)}function P(t,e){return y("timeParse",s.timeParse,e)(t)}function S(t,e){return y("utcParse",s.utcParse,e)(t)}var F=new Date(2e3,0,1);function q(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(F.setMonth(t),F.setDate(e),x(F,n)):""}function A(t){return q(t,1,"%B")}function L(t){return q(t,1,"%b")}function k(t){return q(0,2+t,"%A")}function D(t){return q(0,2+t,"%a")}function z(t,e){let n;return i.isFunction(t)?t:i.isString(t)?(n=e.scales[t])&&n.value:void 0}function R(t,e){const n=z(t,(e||this).context);return n&&n.range?n.range():[]}function O(t,e){const n=z(t,(e||this).context);return n?n.domain():[]}function B(t,e){const n=z(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}function j(t,e,n){return l.bandSpace(t||0,e||0,n||0)}function E(t,e){const n=z(t,(e||this).context);return n?n.copy():void 0}function N(t,e,n){const r=z(t,(n||this).context);return r&&void 0!==e?r(e):void 0}function V(t,e,n){const r=z(t,(n||this).context);return r?i.isArray(e)?(r.invertRange||r.invert)(e):(r.invert||r.invertExtent)(e):void 0}function I(t,e){return function(n,r,o){if(n){const e=z(n,(o||this).context);return e&&e.path[t](r)}return e(r)}}const T=I("area",f.geoArea),X=I("bounds",f.geoBounds),_=I("centroid",f.geoCentroid);function C(t){let e=this.context.group,n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n}function M(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function Y(){return M(this.context.dataflow,"warn",arguments)}function G(){return M(this.context.dataflow,"info",arguments)}function H(){return M(this.context.dataflow,"debug",arguments)}function W(){var t=[].slice.call(arguments);return t.unshift({}),i.extend.apply(null,t)}function $(t,e){return t===e||t!=t&&e!=e||(i.isArray(t)?!(!i.isArray(e)||t.length!==e.length)&&function(t,e){for(let n=0,r=t.length;n<r;++n)if(!$(t[n],e[n]))return!1;return!0}(t,e):!(!i.isObject(t)||!i.isObject(e))&&J(t,e))}function J(t,e){for(let n in t)if(!$(t[n],e[n]))return!1;return!0}function K(t){return e=>J(t,e)}function Q(t,e,r,o,a,c){let u,s,l=this.context.dataflow,f=this.context.data[t],d=f.input,g=f.changes,m=l.stamp();if(!1===l._trigger||!(d.value.length||e||o))return 0;if((!g||g.stamp<m)&&(f.changes=g=l.changeset(),g.stamp=m,l.runAfter((function(){f.modified=!0,l.pulse(d,g).run()}),!0,1)),r&&(u=!0===r?i.truthy:i.isArray(r)||n.isTuple(r)?r:K(r),g.remove(u)),e&&g.insert(e),o&&(u=K(o),d.value.some(u)?g.remove(u):g.insert(o)),a)for(s in c)g.modify(a,s,c[s]);return 1}function U(t){const e=t.touches,n=e[0].clientX-e[1].clientX,r=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+r*r)}function Z(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)}function tt(t,e,n,r,o){t=z(t,(o||this).context);const a=d.Gradient(e,n);let c=t.domain(),u=c[0],s=i.peek(c),f=i.identity;return s-u?f=l.scaleFraction(t,u,s):t=(t.interpolator?l.scale("sequential")().interpolator(t.interpolator()):l.scale("linear")().interpolate(t.interpolate()).range(t.range())).domain([u=0,s=1]),t.ticks&&(u!==(c=t.ticks(+r||15))[0]&&c.unshift(u),s!==i.peek(c)&&c.push(s)),c.forEach(e=>a.stop(f(e),t(e))),a}function et(t,e,n){const r=z(t,(n||this).context);return function(t){return r?r.path.context(t)(e):""}}function nt(t){let e=null;return function(n){return n?d.pathRender(n,e=e||d.pathParse(t)):t}}const rt={};function ot(t){return t.data}function it(t,e){const n=g.call(e,t);return n.root&&n.root.lookup||rt}function at(t,e,n){const r=it(t,this),o=r[e],i=r[n];return o&&i?o.path(i).map(ot):void 0}function ct(t,e){const n=it(t,this)[e];return n?n.ancestors().map(ot):void 0}const ut="undefined"!=typeof window&&window||null;function st(){return ut?ut.screen:{}}function lt(){return ut?[ut.innerWidth,ut.innerHeight]:[void 0,void 0]}function ft(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]}const dt=":",gt="@",mt="%";function pt(t,n,r,o){n[0].type!==e.Literal&&i.error("First argument to data functions must be a string literal.");const a=n[0].value,c=dt+a;if(!i.hasOwnProperty(c,o))try{o[c]=r.getData(a).tuplesRef()}catch(t){}}function ht(t,n,r,o){n[0].type!==e.Literal&&i.error("First argument to indata must be a string literal."),n[1].type!==e.Literal&&i.error("Second argument to indata must be a string literal.");const a=n[0].value,c=n[1].value,u=gt+c;i.hasOwnProperty(u,o)||(o[u]=r.getData(a).indataRef(r,c))}function vt(t,n,r,o){if(n[0].type===e.Literal)yt(r,o,n[0].value);else if(n[0].type===e.Identifier)for(t in r.scales)yt(r,o,t)}function yt(t,e,n){const r=mt+n;if(!i.hasOwnProperty(e,r))try{e[r]=t.scaleRef(n)}catch(t){}}const bt={random:function(){return o.random()},isArray:i.isArray,isBoolean:i.isBoolean,isDate:i.isDate,isDefined:function(t){return void 0!==t},isNumber:i.isNumber,isObject:i.isObject,isRegExp:i.isRegExp,isString:i.isString,isTuple:n.isTuple,isValid:function(t){return null!=t&&t==t},toBoolean:i.toBoolean,toDate:i.toDate,toNumber:i.toNumber,toString:i.toString,flush:i.flush,lerp:i.lerp,merge:W,pad:i.pad,peek:i.peek,span:i.span,inrange:i.inrange,truncate:i.truncate,rgb:c.rgb,lab:c.lab,hcl:c.hcl,hsl:c.hsl,sequence:a.range,format:b,utcFormat:w,utcParse:S,timeFormat:x,timeParse:P,monthFormat:A,monthAbbrevFormat:L,dayFormat:k,dayAbbrevFormat:D,quarter:i.quarter,utcquarter:i.utcquarter,warn:Y,info:G,debug:H,extent:i.extent,inScope:C,intersect:function(t,e,n){if(!t)return[];const[r,o]=t,a=(new d.Bounds).set(r[0],r[1],o[0],o[1]),c=n||this.context.dataflow.scenegraph().root;return d.intersect(c,a,function(t){let e=null;if(t){const n=i.array(t.marktype),r=i.array(t.markname);e=t=>(!n.length||n.some(e=>t.marktype===e))&&(!r.length||r.some(e=>t.name===e))}return e}(e))},clampRange:i.clampRange,pinchDistance:U,pinchAngle:Z,screen:st,containerSize:ft,windowSize:lt,bandspace:j,setdata:p,pathShape:nt,panLinear:i.panLinear,panLog:i.panLog,panPow:i.panPow,panSymlog:i.panSymlog,zoomLinear:i.zoomLinear,zoomLog:i.zoomLog,zoomPow:i.zoomPow,zoomSymlog:i.zoomSymlog,encode:h,modify:Q},xt=["view","item","group","xy","x","y"],wt="event.vega.",Pt="this.",St={};function Ft(t,e,n){return 1===arguments.length?bt[t]:(bt[t]=e,n&&(St[t]=n),At&&(At.functions[t]=Pt+t),this)}Ft("bandwidth",B,vt),Ft("copy",E,vt),Ft("domain",O,vt),Ft("range",R,vt),Ft("invert",V,vt),Ft("scale",N,vt),Ft("gradient",tt,vt),Ft("geoArea",T,vt),Ft("geoBounds",X,vt),Ft("geoCentroid",_,vt),Ft("geoShape",et,vt),Ft("indata",m,ht),Ft("data",g,pt),Ft("treePath",at,pt),Ft("treeAncestors",ct,pt),Ft("vlSelectionTest",r.selectionTest,r.selectionVisitor),Ft("vlSelectionResolve",r.selectionResolve,r.selectionVisitor);const qt={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(t){return"_["+i.stringValue("$"+t)+"]"},functions:function(t){const n=e.functions(t);xt.forEach(t=>n[t]=wt+t);for(let t in bt)n[t]=Pt+t;return n},constants:e.constants,visitors:St};var At=e.codegen(qt);Object.defineProperty(t,"formatLocale",{enumerable:!0,get:function(){return u.formatDefaultLocale}}),Object.defineProperty(t,"timeFormatLocale",{enumerable:!0,get:function(){return s.timeFormatDefaultLocale}}),t.DataPrefix=dt,t.IndexPrefix=gt,t.ScalePrefix=mt,t.SignalPrefix="$",t.bandspace=j,t.bandwidth=B,t.codeGenerator=At,t.codegenParams=qt,t.containerSize=ft,t.copy=E,t.data=g,t.dataVisitor=pt,t.dayAbbrevFormat=D,t.dayFormat=k,t.debug=H,t.domain=O,t.encode=h,t.expressionFunction=Ft,t.format=b,t.functionContext=bt,t.geoArea=T,t.geoBounds=X,t.geoCentroid=_,t.geoShape=et,t.inScope=C,t.indata=m,t.indataVisitor=ht,t.info=G,t.invert=V,t.merge=W,t.modify=Q,t.monthAbbrevFormat=L,t.monthFormat=A,t.pathShape=nt,t.pinchAngle=Z,t.pinchDistance=U,t.range=R,t.scale=N,t.scaleGradient=tt,t.scaleVisitor=vt,t.screen=st,t.setdata=p,t.timeFormat=x,t.timeParse=P,t.treeAncestors=ct,t.treePath=at,t.utcFormat=w,t.utcParse=S,t.warn=Y,t.windowSize=lt,Object.defineProperty(t,"__esModule",{value:!0})}));